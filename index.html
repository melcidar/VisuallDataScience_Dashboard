<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gender Gaps â€“ World Map</title>

  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    h1 {
      text-align: center;
    }
    #vis {
      max-width: 1100px;
      margin: auto;
    }
  </style>
</head>

<body>

<h1>Gender Gaps in Education per World Bank Regions</h1>
<div id="vis"></div>

<script>
const spec = {
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 1000,
  "height": 520,

  "signals": [
    { "name": "year", "value": 2020 },
    { "name": "level", "value": "primary" }
  ],

  "data": [
    {
      "name": "world",
      "url": "https://vega.github.io/vega-datasets/data/world-110m.json",
      "format": { "type": "topojson", "feature": "countries" }
    },

    {
      "name": "wb_regions",
      "url": "country_to_wb_region_array.json"
    },

    {
      "name": "education",
      "url": "data.json",
      "transform": [
        { "type": "filter", "expr": "datum.year == year && datum.level == level" },
        {
          "type": "aggregate",
          "groupby": ["region"],
          "fields": ["gender_gap"],
          "ops": ["mean"],
          "as": ["gender_gap"]
        }
      ]
    }
  ],

  "projections": [
    {
      "name": "proj",
      "type": "equalEarth"
    }
  ],

  "scales": [
    {
      "name": "color",
      "type": "linear",
      "domain": { "data": "education", "field": "gender_gap" },
      "range": { "scheme": "redblue" },
      "reverse": true
    }
  ],

"marks": [
  {
    "type": "geoshape",
    "from": { "data": "world" },
    "projection": "proj",
    "transform": [
      {
        "type": "lookup",
        "from": "wb_regions",
        "key": "id",
        "fields": ["id"],
        "values": ["region"]
      },
      {
        "type": "lookup",
        "from": "education",
        "key": "region",
        "fields": ["region"],
        "values": ["gender_gap"]
      }
    ],
    "encode": {
      "enter": {
        "fill": { "scale": "color", "field": "gender_gap" },
        "stroke": { "value": "white" },
        "strokeWidth": { "value": 0.5 }
      },
      "update": {
        "tooltip": {
          "signal": "{'Region': datum.region, 'Gender gap': datum.gender_gap}"
        }
      }
    }
  }
]
};

vegaEmbed("#vis", spec, { actions: false });
</script>

</body>
</html>
